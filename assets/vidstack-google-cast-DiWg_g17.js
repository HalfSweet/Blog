var te=Object.defineProperty;var ee=(c,t,s)=>t in c?te(c,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[t]=s;var mt=(c,t,s)=>(ee(c,typeof t!="symbol"?t+"":t,s),s),Tt=(c,t,s)=>{if(!t.has(c))throw TypeError("Cannot "+s)};var e=(c,t,s)=>(Tt(c,t,"read from private field"),s?s.call(c):t.get(c)),r=(c,t,s)=>{if(t.has(c))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(c):t.set(c,s)},u=(c,t,s,i)=>(Tt(c,t,"write to private field"),i?i.call(c,s):t.set(c,s),s);var a=(c,t,s)=>(Tt(c,t,"access private method"),s);import{aF as se,aj as wt,o as ie,E as _t,p as ft,l as Dt,t as ae,G as re}from"./vidstack-Ds_q5BGO-BmIdNEue.js";import{T as L,L as ne}from"./vidstack-player-CGtoCiBG.js";import{R as oe}from"./vidstack-DSYpsFWk-CqqLDmWv.js";import{g as he,a as ce,b as xt,h as Pt,l as de,c as ue}from"./vidstack-CWDlegKy-DbZbCW_8.js";import"./app-BvW9zp2N.js";import"./vidstack-DXXgp8ue-BEqIG_iI.js";var T,j,Gt;class le{constructor(t){r(this,j);r(this,T,void 0);u(this,T,new chrome.cast.media.MediaInfo(t.src,t.type))}build(){return e(this,T)}setStreamType(t){return t.includes("live")?e(this,T).streamType=chrome.cast.media.StreamType.LIVE:e(this,T).streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(t){return e(this,T).tracks=t.map(a(this,j,Gt)),this}setMetadata(t,s){return e(this,T).metadata=new chrome.cast.media.GenericMediaMetadata,e(this,T).metadata.title=t,e(this,T).metadata.images=[{url:s}],this}}T=new WeakMap,j=new WeakSet,Gt=function(t,s){const i=new chrome.cast.media.Track(s,chrome.cast.media.TrackType.TEXT);return i.name=t.label,i.trackContentId=t.src,i.trackContentType="text/vtt",i.language=t.language,i.subtype=t.kind.toUpperCase(),i};const gt=chrome.cast.media.TrackType.TEXT,Nt=chrome.cast.media.TrackType.AUDIO;var y,g,_,D,kt,p,A,z,Ot,J,Vt,Q,$t,P,yt,I,X,N,pt;class me{constructor(t,s,i){r(this,D);r(this,p);r(this,z);r(this,J);r(this,Q);r(this,P);r(this,I);r(this,N);r(this,y,void 0);r(this,g,void 0);r(this,_,void 0);u(this,y,t),u(this,g,s),u(this,_,i)}setup(){const t=this.syncRemoteActiveIds.bind(this);Dt(e(this,g).audioTracks,"change",t),Dt(e(this,g).textTracks,"mode-change",t),ae(a(this,J,Vt).bind(this))}getLocalTextTracks(){return e(this,g).$state.textTracks().filter(t=>t.src&&t.type==="vtt")}syncRemoteTracks(t){if(!e(this,y).isMediaLoaded)return;const s=a(this,D,kt).call(this),i=this.getLocalTextTracks(),n=a(this,p,A).call(this,Nt),l=a(this,p,A).call(this,gt);for(const d of n){if(a(this,P,yt).call(this,s,d))continue;const w={id:d.trackId.toString(),label:d.name,language:d.language,kind:d.subtype??"main",selected:!1};e(this,g).audioTracks[ne.add](w,t)}for(const d of l){if(a(this,P,yt).call(this,i,d))continue;const w={id:d.trackId.toString(),src:d.trackContentId,label:d.name,language:d.language,kind:d.subtype.toLowerCase()};e(this,g).textTracks.add(w,t)}}syncRemoteActiveIds(t){if(!e(this,y).isMediaLoaded)return;const s=a(this,z,Ot).call(this),i=new chrome.cast.media.EditTracksInfoRequest(s);a(this,Q,$t).call(this,i).catch(n=>{})}}y=new WeakMap,g=new WeakMap,_=new WeakMap,D=new WeakSet,kt=function(){return e(this,g).$state.audioTracks()},p=new WeakSet,A=function(t){var i;const s=((i=e(this,y).mediaInfo)==null?void 0:i.tracks)??[];return t?s.filter(n=>n.type===t):s},z=new WeakSet,Ot=function(){const t=[],s=a(this,D,kt).call(this).find(n=>n.selected),i=this.getLocalTextTracks().filter(n=>n.mode==="showing");if(s){const n=a(this,p,A).call(this,Nt),l=a(this,I,X).call(this,n,s);l&&t.push(l.trackId)}if(i!=null&&i.length){const n=a(this,p,A).call(this,gt);if(n.length)for(const l of i){const d=a(this,I,X).call(this,n,l);d&&t.push(d.trackId)}}return t},J=new WeakSet,Vt=function(){const t=this.getLocalTextTracks();if(!e(this,y).isMediaLoaded)return;const s=a(this,p,A).call(this,gt);for(const i of t)if(!a(this,I,X).call(this,s,i)){re(()=>{var l;return(l=e(this,_))==null?void 0:l.call(this)});break}},Q=new WeakSet,$t=function(t){const s=xt();return new Promise((i,n)=>s==null?void 0:s.editTracksInfo(t,i,n))},P=new WeakSet,yt=function(t,s){return t.find(i=>a(this,N,pt).call(this,i,s))},I=new WeakSet,X=function(t,s){return t.find(i=>a(this,N,pt).call(this,s,i))},N=new WeakSet,pt=function(t,s){return s.name===t.label&&s.language===t.language&&s.subtype.toLowerCase()===t.kind.toLowerCase()};var o,h,E,C,x,R,v,S,b,G,m,M,W,Ht,Z,Ut,O,Et,tt,Ft,V,Ct,et,qt,st,Yt,it,Bt,$,Lt,H,vt,U,St,F,At,at,Kt,rt,Xt,nt,jt,q,It,ot,zt,Y,Rt,ht,Jt,B,bt,f,k,ct,Qt,dt,Wt,K,Mt,ut,Zt;class Ce{constructor(t,s){r(this,W);r(this,Z);r(this,O);r(this,tt);r(this,V);r(this,et);r(this,st);r(this,it);r(this,$);r(this,H);r(this,U);r(this,F);r(this,at);r(this,rt);r(this,nt);r(this,q);r(this,ot);r(this,Y);r(this,ht);r(this,B);r(this,f);r(this,ct);r(this,dt);r(this,K);r(this,ut);mt(this,"$$PROVIDER_TYPE","GOOGLE_CAST");mt(this,"scope",se());r(this,o,void 0);r(this,h,void 0);r(this,E,void 0);r(this,C,null);r(this,x,"disconnected");r(this,R,0);r(this,v,0);r(this,S,new L(0,0));r(this,b,new oe(a(this,st,Yt).bind(this)));r(this,G,void 0);r(this,m,null);r(this,M,!1);u(this,o,t),u(this,h,s),u(this,E,new me(t,s,a(this,ut,Zt).bind(this)))}get type(){return"google-cast"}get currentSrc(){return e(this,C)}get player(){return e(this,o)}get cast(){return he()}get session(){return ce()}get media(){return xt()}get hasActiveSession(){return Pt(e(this,C))}setup(){a(this,W,Ht).call(this),a(this,Z,Ut).call(this),e(this,E).setup(),e(this,h).notify("provider-setup",this)}async play(){var t;if(!(!e(this,o).isPaused&&!e(this,M))){if(e(this,M)){await a(this,K,Mt).call(this,!1,0);return}(t=e(this,o).controller)==null||t.playOrPause()}}async pause(){var t;e(this,o).isPaused||(t=e(this,o).controller)==null||t.playOrPause()}getMediaStatus(t){return new Promise((s,i)=>{var n;(n=this.media)==null||n.getStatus(t,s,i)})}setMuted(t){var i;(t&&!e(this,o).isMuted||!t&&e(this,o).isMuted)&&((i=e(this,o).controller)==null||i.muteOrUnmute())}setCurrentTime(t){var s;e(this,o).currentTime=t,e(this,h).notify("seeking",t),(s=e(this,o).controller)==null||s.seek()}setVolume(t){var s;e(this,o).volumeLevel=t,(s=e(this,o).controller)==null||s.setVolumeLevel()}async loadSource(t){var n;if(((n=e(this,m))==null?void 0:n.src)!==t&&u(this,m,null),Pt(t)){a(this,tt,Ft).call(this),u(this,C,t);return}e(this,h).notify("load-start");const s=a(this,dt,Wt).call(this,t),i=await this.session.loadMedia(s);if(i){u(this,C,null),e(this,h).notify("error",Error(ue(i)));return}u(this,C,t)}destroy(){a(this,O,Et).call(this),a(this,V,Ct).call(this)}}o=new WeakMap,h=new WeakMap,E=new WeakMap,C=new WeakMap,x=new WeakMap,R=new WeakMap,v=new WeakMap,S=new WeakMap,b=new WeakMap,G=new WeakMap,m=new WeakMap,M=new WeakMap,W=new WeakSet,Ht=function(){de(cast.framework.CastContextEventType.CAST_STATE_CHANGED,a(this,$,Lt).bind(this))},Z=new WeakSet,Ut=function(){const t=cast.framework.RemotePlayerEventType,s={[t.IS_CONNECTED_CHANGED]:a(this,$,Lt),[t.IS_MEDIA_LOADED_CHANGED]:a(this,H,vt),[t.CAN_CONTROL_VOLUME_CHANGED]:a(this,U,St),[t.CAN_SEEK_CHANGED]:a(this,F,At),[t.DURATION_CHANGED]:a(this,nt,jt),[t.IS_MUTED_CHANGED]:a(this,q,It),[t.VOLUME_LEVEL_CHANGED]:a(this,q,It),[t.IS_PAUSED_CHANGED]:a(this,ot,zt),[t.LIVE_SEEKABLE_RANGE_CHANGED]:a(this,Y,Rt),[t.PLAYER_STATE_CHANGED]:a(this,ht,Jt)};u(this,G,s);const i=a(this,it,Bt).bind(this);for(const n of wt(s))e(this,o).controller.addEventListener(n,i);ie(()=>{for(const n of wt(s))e(this,o).controller.removeEventListener(n,i)})},O=new WeakSet,Et=function(){e(this,m)||(u(this,v,0),u(this,S,new L(0,0))),e(this,b).stop(),u(this,R,0),u(this,m,null)},tt=new WeakSet,Ft=function(){const t=new _t("resume-session",{detail:this.session});a(this,H,vt).call(this,t);const{muted:s,volume:i,savedState:n}=e(this,h).$state,l=n();this.setCurrentTime(Math.max(e(this,o).currentTime,(l==null?void 0:l.currentTime)??0)),this.setMuted(s()),this.setVolume(i()),(l==null?void 0:l.paused)===!1&&this.play()},V=new WeakSet,Ct=function(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=e(this,h).$state;t.set(null)},et=new WeakSet,qt=function(){const{savedState:t}=e(this,h).$state;t.set({paused:e(this,o).isPaused,currentTime:e(this,o).currentTime}),a(this,V,Ct).call(this)},st=new WeakSet,Yt=function(){a(this,rt,Xt).call(this)},it=new WeakSet,Bt=function(t){e(this,G)[t.type].call(this,t)},$=new WeakSet,Lt=function(t){const s=this.cast.getCastState(),i=s===cast.framework.CastState.CONNECTED?"connected":s===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(e(this,x)===i)return;const n={type:"google-cast",state:i},l=a(this,f,k).call(this,t);u(this,x,i),e(this,h).notify("remote-playback-change",n,l),i==="disconnected"&&a(this,et,qt).call(this)},H=new WeakSet,vt=function(t){if(!!!e(this,o).isMediaLoaded)return;const i=ft(e(this,h).$state.source);Promise.resolve().then(()=>{if(i!==ft(e(this,h).$state.source)||!e(this,o).isMediaLoaded)return;a(this,O,Et).call(this);const n=e(this,o).duration;u(this,S,new L(0,n));const l={provider:this,duration:n,buffered:new L(0,0),seekable:a(this,B,bt).call(this)},d=a(this,f,k).call(this,t);e(this,h).notify("loaded-metadata",void 0,d),e(this,h).notify("loaded-data",void 0,d),e(this,h).notify("can-play",l,d),a(this,U,St).call(this),a(this,F,At).call(this,t);const{volume:lt,muted:w}=e(this,h).$state;this.setVolume(lt()),this.setMuted(w()),e(this,b).start(),e(this,E).syncRemoteTracks(d),e(this,E).syncRemoteActiveIds(d)})},U=new WeakSet,St=function(){e(this,h).$state.canSetVolume.set(e(this,o).canControlVolume)},F=new WeakSet,At=function(t){const s=a(this,f,k).call(this,t);e(this,h).notify("stream-type-change",a(this,at,Kt).call(this),s)},at=new WeakSet,Kt=function(){var s;return((s=e(this,o).mediaInfo)==null?void 0:s.streamType)===chrome.cast.media.StreamType.LIVE?e(this,o).canSeek?"live:dvr":"live":"on-demand"},rt=new WeakSet,Xt=function(){if(e(this,m))return;const t=e(this,o).currentTime;t!==e(this,R)&&(e(this,h).notify("time-change",t),t>e(this,v)&&(u(this,v,t),a(this,Y,Rt).call(this)),e(this,h).$state.seeking()&&e(this,h).notify("seeked",t),u(this,R,t))},nt=new WeakSet,jt=function(t){if(!e(this,o).isMediaLoaded||e(this,m))return;const s=e(this,o).duration,i=a(this,f,k).call(this,t);u(this,S,new L(0,s)),e(this,h).notify("duration-change",s,i)},q=new WeakSet,It=function(t){if(!e(this,o).isMediaLoaded)return;const s={muted:e(this,o).isMuted,volume:e(this,o).volumeLevel},i=a(this,f,k).call(this,t);e(this,h).notify("volume-change",s,i)},ot=new WeakSet,zt=function(t){const s=a(this,f,k).call(this,t);e(this,o).isPaused?e(this,h).notify("pause",void 0,s):e(this,h).notify("play",void 0,s)},Y=new WeakSet,Rt=function(t){const s={seekable:a(this,B,bt).call(this),buffered:new L(0,e(this,v))},i=t?a(this,f,k).call(this,t):void 0;e(this,h).notify("progress",s,i)},ht=new WeakSet,Jt=function(t){const s=e(this,o).playerState,i=chrome.cast.media.PlayerState;if(u(this,M,s===i.IDLE),s===i.PAUSED)return;const n=a(this,f,k).call(this,t);switch(s){case i.PLAYING:e(this,h).notify("playing",void 0,n);break;case i.BUFFERING:e(this,h).notify("waiting",void 0,n);break;case i.IDLE:e(this,b).stop(),e(this,h).notify("pause"),e(this,h).notify("end");break}},B=new WeakSet,bt=function(){return e(this,o).liveSeekableRange?new L(e(this,o).liveSeekableRange.start,e(this,o).liveSeekableRange.end):e(this,S)},f=new WeakSet,k=function(t){return t instanceof Event?t:new _t(t.type,{detail:t})},ct=new WeakSet,Qt=function(t){const{streamType:s,title:i,poster:n}=e(this,h).$state;return new le(t).setMetadata(i(),n()).setStreamType(s()).setTracks(e(this,E).getLocalTextTracks()).build()},dt=new WeakSet,Wt=function(t){var l,d;const s=a(this,ct,Qt).call(this,t),i=new chrome.cast.media.LoadRequest(s),n=e(this,h).$state.savedState();return i.autoplay=(((l=e(this,m))==null?void 0:l.paused)??(n==null?void 0:n.paused))===!1,i.currentTime=((d=e(this,m))==null?void 0:d.time)??(n==null?void 0:n.currentTime)??0,i},K=new WeakSet,Mt=async function(t,s){const i=ft(e(this,h).$state.source);u(this,m,{src:i,paused:t,time:s}),await this.loadSource(i)},ut=new WeakSet,Zt=function(){a(this,K,Mt).call(this,e(this,o).isPaused,e(this,o).currentTime).catch(t=>{})};export{Ce as GoogleCastProvider};
