<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>墨水屏的坑——7.5寸墨水屏刷新为何出现条纹 | HalfSweet&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="半糖的个人博客，记录与探索每一个新奇的问题 ">
    <meta name="keywords" content="半糖,HalfSweet,嵌入式,Arduino,ESP32,ESP8266,EPD,EPaper,墨水屏,学习,STM32,RTOS,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.1c528986.css" as="style"><link rel="preload" href="/assets/js/app.1afa087c.js" as="script"><link rel="preload" href="/assets/js/2.eb2c3b01.js" as="script"><link rel="preload" href="/assets/js/3.08d8fe6e.js" as="script"><link rel="prefetch" href="/assets/js/10.6077db60.js"><link rel="prefetch" href="/assets/js/11.5bfc6433.js"><link rel="prefetch" href="/assets/js/12.53470d39.js"><link rel="prefetch" href="/assets/js/13.2d9b5da1.js"><link rel="prefetch" href="/assets/js/14.1d038b19.js"><link rel="prefetch" href="/assets/js/15.a7262586.js"><link rel="prefetch" href="/assets/js/16.6e00bf79.js"><link rel="prefetch" href="/assets/js/17.0ae85586.js"><link rel="prefetch" href="/assets/js/18.c560366f.js"><link rel="prefetch" href="/assets/js/19.e3290607.js"><link rel="prefetch" href="/assets/js/20.685a254a.js"><link rel="prefetch" href="/assets/js/21.4fcd47e8.js"><link rel="prefetch" href="/assets/js/22.66a3af35.js"><link rel="prefetch" href="/assets/js/4.44abc4a8.js"><link rel="prefetch" href="/assets/js/5.929a591a.js"><link rel="prefetch" href="/assets/js/6.d0889f04.js"><link rel="prefetch" href="/assets/js/7.c07ebf02.js"><link rel="prefetch" href="/assets/js/8.1a7a341e.js"><link rel="prefetch" href="/assets/js/9.c9677956.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c528986.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/LOGO.png" alt="HalfSweet's blog" class="logo"> <span class="site-name can-hide">HalfSweet's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">技术文章</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/HalfSweet/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/Headshot.jpg"> <div class="blogger-info"><h3>HalfSweet</h3> <span>这里是半糖</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">技术文章</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/HalfSweet/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/posts/HelloWorld/" class="sidebar-link">HelloWorld</a></li><li><a href="/posts/EpdTraps1/" aria-current="page" class="active sidebar-link">墨水屏的坑——7.5寸墨水屏刷新为何出现条纹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/posts/EpdTraps1/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header level2"><a href="/posts/EpdTraps1/#大佬相助" class="sidebar-link">大佬相助</a></li><li class="sidebar-sub-header level2"><a href="/posts/EpdTraps1/#初寻端倪" class="sidebar-link">初寻端倪</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/posts/EpdTraps1/#tcon-setting" class="sidebar-link">TCON SETTING</a></li><li class="sidebar-sub-header level3"><a href="/posts/EpdTraps1/#修改pll" class="sidebar-link">修改PLL</a></li><li class="sidebar-sub-header level3"><a href="/posts/EpdTraps1/#真凶在此" class="sidebar-link">真凶在此</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/posts/EpdTraps1/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level2"><a href="/posts/EpdTraps1/#备注" class="sidebar-link">备注</a></li></ul></li><li><a href="/posts/conda_novelai/" class="sidebar-link">基于conda进行手动配置novelAI</a></li><li><a href="/posts/embedded_fmtlib/" class="sidebar-link">在嵌入式设备上使用fmtlib</a></li><li><a href="/posts/STC_CoreMark/" class="sidebar-link">不服来跑个分？将CoreMark移植到STC上试试</a></li><li><a href="/posts/SEGGER-RTT/" class="sidebar-link">更高效的日志查看方式——使用SEGGER-RTT</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/posts/#posts" data-v-06225672>posts</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/HalfSweet" target="_blank" title="作者" class="beLink" data-v-06225672>HalfSweet</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-11-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->墨水屏的坑——7.5寸墨水屏刷新为何出现条纹<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>之前在我群里的同学应该都还记得，之前有朋友送给半糖两块7.5寸的墨水屏，其中一块是黑白双色的，标签型号是DEPG0750RWU790F30，驱动芯片则是UC8179。这块屏确实蛮好的，有着高达800*480的分辨率，并且因为是7.5寸所以可视面积非常大，但是在调试的过程中半糖发现了一个问题：这个屏幕的刷新过程中怎么会出现白色条纹，并且刷完的颜色非常怪？</p> <p><img src="/assets/img/Refresh1.6eb56d8a.gif" alt=""></p> <p><img src="/assets/img/Refresh2.b7c21ded.gif" alt=""></p> <p>其中上面一张图为我自己做的波形，第二张为使用的OTP波形，但是无一例外，都出现了刷新的问题。抱着也许是驱动板出问题了的想法，我重新lay了一次板子，焊接好之后发现问题确实有所改善，但是并不佳。后续在更换过程中发现采用cd32封装的68uH的电感刷新效果会更好一些，但是依旧存在刷新问题，特别是在UI中有竖着的线条的时候，特别影响观感。</p> <h2 id="大佬相助"><a href="#大佬相助" class="header-anchor">#</a> 大佬相助</h2> <p>时间过得飞快，到了前几天，想着我解决不了这个问题就拉帮手的想法，我将这块屏寄给了<a href="https://github.com/axdz007" target="_blank" rel="noopener noreferrer">滚筒洗衣机<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>大佬，然后在我的<s>威逼利诱</s>强烈要求下，我们开始了新一轮的测试。</p> <p>果不其然，在他移植了我之前写的程序的时候，问题便复现了。</p> <iframe src="/EpdTraps1/Refresh3.mp4" style="vertical-align:top;width:100%;height:100%;"></iframe> <p>经过一系列的检查，排除了是取模方式等的因素，我们惊讶地发现…大连佳显的官方例程里面给的图片可以完美显示？紧接着我们又试了下全0xAA以及0x55的数据，理论上这样推上去的图像将是完整的一条条1像素的黑白条纹，结果……非常完美。既然横条没问题，那么竖条呢？出现了一点小问题。那么棋盘格呢？问题大了，屏幕甚至想要拒绝刷新。紧接着尝试了别的图像，结果出现了非常奇怪的效果，如果黑色比较少，分得比较开，那么刷出来没有任何问题，但是刷图片类似的比较复杂的形状又会炸掉。难道是内存出现了什么毛病？</p> <p>紧接着检查，发现了一个我们之前忽视的点，硬件驱动电路！</p> <p><img src="/assets/img/SCH1.2a56199f.jpg" alt=""></p> <p>可以看出，与常规的墨水屏驱动电路相比，该电路的高压部分电容均为10uF，并且boost电荷泵部分的电容为4.7uF，会是这个原因吗？于是大佬开始了他的飞线操作。</p> <p><img src="/assets/img/PCB1.4b8b01e9.jpg" alt=""></p> <p>不得不说大佬技艺高超，很快就把缺失的电容补上了，那么，工作正常了吗？</p> <p>事实证明还是有所效果，刷图的质量明显好了不少，像素棋盘格也能正常显示了，这下刷图片总没有问题了吧？</p> <p>没有意外的话现在就要出意外了，令人惊讶的是棋盘格能显示，但是刷的图片还是依旧炸裂。这就奇了怪了，刷全白正常，刷全黑正常，刷条纹正常，甚至刷棋盘格也正常，但是刷区区一张图片竟然出现了问题？难道是芯片设计的bug吗。</p> <h2 id="初寻端倪"><a href="#初寻端倪" class="header-anchor">#</a> 初寻端倪</h2> <h3 id="tcon-setting"><a href="#tcon-setting" class="header-anchor">#</a> TCON SETTING</h3> <p>经过了一系列的尝试，我们将重心转移到了寄存器的配置上。首先我注意到了一个0x60的寄存器，这个寄存器的描述为“TCON SETTING”，内容为“This command defines non-overlap period of Gate and Source.”是因为内部的时序问题才导致的刷新不正常吗？但是在修改之后未果，故障依旧。同时参考了同芯片的微雪的屏幕驱动代码，该寄存器的设置的值并不一致，但是修改后故障依旧。</p> <h3 id="修改pll"><a href="#修改pll" class="header-anchor">#</a> 修改PLL</h3> <p>我们联想到，如果是时序导致的出错，那么降低频率是否会好一些？于是我们便尝试了修改屏幕的PLL参数，该寄存器地址为0x30。神奇的事发生了，在大佬降低PLL到5Hz之后，发现之前刷新炸掉的图片竟然能正常刷新了！除了刷的很慢之外并没有什么多余的问题。紧接着又尝试了4灰度使用内部OTP波形进行刷新，发现依然能正常刷新。</p> <p>难道是因为屏幕厂商的内部布线问题，导致时钟开太高会有干扰？想想便感觉非常不合理，还是说难道屏厂在测试的时候使用的都是比较简单的图片，因此并没有发现刷新的问题？不管什么样的解释，显得都非常牵强，但是目前我们也找不到更好的解决方案，因此便告一段落，并一致认为大概率是屏厂设计导致的硬件问题。</p> <h3 id="真凶在此"><a href="#真凶在此" class="header-anchor">#</a> 真凶在此</h3> <p>在闲聊中，我们发现威锋有一款5.83寸的屏幕与这块屏幕采用了同款驱动芯片，于是大佬便决定把5.83屏幕的初始化代码搬过来试试。令人意想不到的情况出现了，竟然……好了？在这样的初始化代码下，屏幕的刷新竟然无比的丝滑顺畅，似乎本该如此，可是，为什么呢？</p> <p>幸而5.83屏的初始化代码非常简洁，我们很轻易就可以发现不同点：主要便是0x06这个寄存器。</p> <p><img src="/assets/img/Code1.7e2cfc90.jpg" alt="5.83屏幕的初始化代码"></p> <p>那么，这个寄存器是做什么用的呢？</p> <p><img src="/assets/img/Datasheet1.e0082687.png" alt=""></p> <p>虽然描述寥寥，但是我们依稀能看出是与boost升压有关，并且第三个数据默认值为0x17，而5.83屏幕的初始化代码中为0x28，是否就是这个寄存器导致的呢？我们将这段初始化代码复制了过去。</p> <p>意想不到的事出现了，正常了，彻底正常了！没有讨厌的条纹，没有刷新后掉色，屏幕安安静静刷新出一帧的画面，自然又好看。</p> <p><img src="/assets/img/Epd1.4d0d54d1.jpg" alt=""></p> <p>虽然我找了下相同芯片的在GxEpd2库下方的代码，发现或多或少都对这个寄存器进行了配置，有<code>0x17,0x17,0x28</code>的，有<code>0xC7,0xCC,0x28</code>的，还有<code>0x17,0x17,0x39,0x17</code>的，大家都没有采用默认的四个0x17的值。不知道大佬佳显是抱着怎样的想法，漏掉了这个至关重要的寄存器，也许是屏厂给的测试代码就没有。</p> <p>这个寄存器没有具体的描述，在SSD芯片中也有类似的寄存器，但是同样额米有具体的文字描述，根据名字来看，或许和boost有关，并且不同的值应该与驱动能力有关，但是具体有什么用，ABC相有什么区别，我不得而知，如果有知道的同学可以告诉我，不胜感激（）</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>总而言之，经过了一晚上的忙活，查找了各种原因，结果发现是一个寄存器没有配置。虽然问题不大，但是蛮折磨人的，并且也不知道是具体原因。不过有了这次的经验，在下次遇到类似的故障的时候，想必找到问题出现的原因会更加轻松。</p> <h2 id="备注"><a href="#备注" class="header-anchor">#</a> 备注</h2> <p>DEPG0750RWU790F30这块屏幕请记住，一定要配置0x06的寄存器！！！相同尺寸的相同驱动芯片的屏幕应该也大致如此，希望能帮到更多遇到类似问题的同学。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/HalfSweet/Blog/edit/main/docs/posts/01.墨水屏的坑——7.5寸墨水屏刷新为何出现条纹.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E5%A2%A8%E6%B0%B4%E5%B1%8F" title="标签">#墨水屏</a><a href="/tags/?tag=UC8179" title="标签">#UC8179</a><a href="/tags/?tag=DEPG0750RWU790F30" title="标签">#DEPG0750RWU790F30</a><a href="/tags/?tag=%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91" title="标签">#遇到的坑</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/11/06, 13:31:05</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/posts/HelloWorld/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">HelloWorld</div></a> <a href="/posts/conda_novelai/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">基于conda进行手动配置novelAI</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/posts/HelloWorld/" class="prev">HelloWorld</a></span> <span class="next"><a href="/posts/conda_novelai/">基于conda进行手动配置novelAI</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/posts/SEGGER-RTT/"><div>
            更高效的日志查看方式——使用SEGGER-RTT
            <!----></div></a> <span class="date">05-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/posts/STC_CoreMark/"><div>
            不服来跑个分？将CoreMark移植到STC上试试
            <!----></div></a> <span class="date">04-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4033e3/"><div>
            HSEPD-Arduino驱动库的实现思路
            <!----></div></a> <span class="date">04-13</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="halfsweet@halfsweet.cn" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/HalfSweet" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://twitter.com/_HalfSweet" title="Twitter" target="_blank" class="iconfont icon-twitter"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>HalfSweet | <a href="https://github.com/HalfSweet/Blog/blob/main/LICENSE" target="_blank">CC-BY-SA-4.0 License</a> <br> <a href="https://beian.miit.gov.cn/#/Integrated/index">黔ICP备2021007368号</a> </br></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.1afa087c.js" defer></script><script src="/assets/js/2.eb2c3b01.js" defer></script><script src="/assets/js/3.08d8fe6e.js" defer></script>
  </body>
</html>
